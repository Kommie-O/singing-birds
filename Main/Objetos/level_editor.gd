extends Node2D



const  in_edit_mode: bool = false
var current_level_name = "LECHUZA_TANGUERA"


var fk_fall_time: float = -3.2
var fk_output_arr = [[], [], [], []]

var level_info = {
	"LECHUZA_TANGUERA" = {
		"fk_times": "[[-2.11206347942352, -1.6640816450119, -1.37609977722168, 0.94945569038391, 0.53349204063416, 1.97884364128113, 1.69086165428162, 1.28555555343628, 2.88024921417236, 2.3682767868042, 2.17628116607666, 2.25036268234253, 2.85834484100342, 3.95433120727539, 3.43430833816528, 3.60496597290039, 3.92494325637817, 4.38358287811279, 4.5542405128479, 5.06621341705322, 5.2688663482666, 5.63151912689209, 6.21816329956055, 6.6981409072876, 6.89011363983154, 7.2741039276123, 7.70074825286865, 8.02072601318359, 8.46870784759521, 8.63936500549316, 9.03401355743408, 9.43931941986084, 9.59931926727295, 10.12194995880127, 10.27126960754395,10.43126945495606, 10.59088401794434, 10.95390014648438, 10.18854885101318, 11.31655292510986, 11.68986396789551, 11.87117938995361, 12.8631294250488, 13.0551250457764, 13.2151248931885, 13.4391162872314, 13.6204307556152, 14.0150802612305, 14.2070739746094, 14.3883903503418, 14.601700592041, 14.9643543243408, 15.1670063018799, 16.0309741973877, 16.2229469299316, 16.3829486846924, 16.7456005096436, 16.9162586212158, 17.2895687103271, 17.7482078552246, 17.9188659667969, 18.4201820373535, 18.580158996582, 19.2201354980469, 19.3907936096191, 20.0520866394043, 20.2227428436279, 20.6173923492432, 21.0653732299805, 21.2466896057129, 21.7480037689209, 21.9506576538086, 22.2706344604492, 22.7186172485352, 22.8892734527588, 23.4012477874756, 23.5719039916992, 23.9878681182861, 24.4038551330566, 24.5638549804688, 25.0971420288086, 25.2678001403809, 25.6837871551514, 25.8864391326904, 26.0570972442627, 26.2384346008301, 26.4197509765625, 26.6224029541016, 26.8143985748291, 26.9957149505615, 27.6890247344971, 27.8703392028809, 28.0516555786133, 28.3823135375977, 28.5849655151367, 28.9369400024414, 29.3635833740234, 30.0782325744629, 30.2702033996582, 30.4515426635742, 30.6541946411133, 30.8461921691895, 31.0488441467285, 31.3368270874023, 31.7314727783203, 31.9661224365234, 32.3500907897949, 32.7874153137207, 33.0114067077637, 33.4487083435059, 33.6193664550781, 34.5793197631836, 34.9206359863281, 35.1339462280273, 35.3365982055664, 35.6565979003906, 36.2965515136719, 36.488549041748, 36.6485488891602, 36.8298652648926, 37.0111778259277, 37.9178016662598, 38.1844680786133, 38.4511116027832, 38.6324279785156, 38.8884132385254, 39.1124046325684, 39.3043983459473, 39.4963958740234, 39.7203872680664, 40.1043556213379, 40.285668182373, 41.0323112487793, 41.2029693603516, 41.3629463195801, 41.7362602233887, 41.9175956726074, 42.3015640258789, 42.7175491333008, 42.9202049255371, 43.4855087280273, 43.6668251037598, 43.8161666870117, 44.018822479248, 44.5841262817383, 45.0640800476074, 45.2774131774902, 45.6293876647949, 46.088028717041, 46.2693641662598, 46.7173469543457, 47.8986633300781, 47.8479354858398, 48.1039245605469, 48.4452369689941, 48.6372344970703, 49.0318801879883, 49.6185272216797, 49.7785041809082, 50.215828704834, 50.3971412658691, 51.1544425964355, 51.3144233703613, 51.7837417602539, 51.9650581359863, 52.3703620910645, 52.7330177307129, 52.8823364257812, 54.4049880981445, 54.564965057373, 54.4822662353516, 54.6422431945801, 55.1115653991699, 55.2822235107422, 55.6341941833496, 56.0686386108398, 56.8714721679687, 57.0527885437012, 57.2127883911133, 57.4154403686523, 57.5860984802246, 57.8527420043945, 58.4820411682129, 58.716690826416, 58.866032409668, 59.0366905212402,59.2180030822754, 59.6126525878906, 60.1352851867676, 60.2952850341797, 60.4765975952148, 60.6792533874512, 60.9139221191406, 61.2445571899414, 61.4258926391602, 61.6392028808594, 61.8205459594727, 62.012516784668, 63.3777740478516, 63.6337631225586, 63.9004333496094, 64.2950790405273, 64.4870498657227, 64.7323806762695, 65.1696823120117, 65.3510177612305, 65.8523147583008, 66.0443084716797, 66.2363021850586, 66.4816101074219, 66.8336074829102, 67.0149200439453, 67.2282531738281, 67.4949005126953, 67.7935607910156, 68.0815399169922, 68.4015167236328, 68.6361663818359, 69.5321319580078, 69.8094299316406, 70.3107498168945, 70.5347412109375, 70.7160537719727, 70.9293869018555, 70.217366027832, 70.9853256225586, 71.1986358642578, 71.7532852172852, 73.4145782470703, 73.5959213256836, 73.9798858642578, 74.2678649902344, 74.4918563842773, 74.7478454589844, 75.067822265625, 75.3024948120117, 76.4010894775391, 76.5824249267578, 76.8277328491211, 77.0837219238281, 77.3823822021484, 77.8303421020508, 78.0009963989258, 78.4489791870117, 78.6623123168945, 79.0356262207031, 79.4836090087891, 79.6969192504883, 80.1129043579102, 80.3155563354492, 80.7315185546875, 81.1475036621094, 81.5954864501953, 81.8621337890625, 82.0861251831055, 82.3527648925781, 82.598095703125, 82.8114288330078, 83.5153778076172, 83.7180297851562, 84.0273483276367, 84.1766860961914, 84.6779830932617, 85.1153076171875, 85.2966201782227, 85.6805923461914, 86.1819046020508, 86.3845565795898, 86.8005416870117, 86.9925430297852, 87.1631973266602, 87.3338516235352, 87.5365112304687, 87.6538284301758, 87.7924926757812, 87.9631546020508, 88.1338088989258, 88.2831314086914, 88.4431274414062, 88.6350982666016, 88.7951019287109, 88.9657562255859, 89.1257598876953, 89.3177307128906, 89.5310638427734, 90.4270065307617], [77.4836090087891, 77.6862609863281], [-4.08006806373596, -2.54414958953857, -0.90156478881836, 0.80501155853271, 1.00766448974609, 2.40492086410522, 4.03682498931885, 4.23947887420654, 67.8094299316406, 82.4859893798828, 82.7099807739258, 84.1925628662109, 84.3632171630859], [61.3991134643555, 61.6337631225586, 61.9004333496094, 75.7983444213867, 76.0116775512695, 79.1688430786133]]

",
		"music":load("res://Main/Musica/Music_Tango_150BPM_001.wav")
	}
}

func _ready():
	
	$Musica.stream = level_info.get(current_level_name).get("music")
	$Musica.play()
	
	
	if in_edit_mode:
		Senales.KeyListenerPress.connect(KeyListenerPress)
	
	else:
		var fk_times = level_info.get(current_level_name).get("fk_times")
		var fk_times_arr = str_to_var(fk_times)
		
		
		var counter: int= 0
		for key in fk_times_arr:
			
			var button_name: String = ""
			match  counter:
				0:
					button_name = "button_A"
				1:
					button_name = "button_S"
				2:
					button_name = "button_D"
				3:
					button_name = "button_F"
			
			for delay in key:
				SpawnFallingKey(button_name, delay)
				
				counter += 1
		
func KeyListenerPress(button_name: String, array_num: int):
	print(str(array_num) + " " + str($Musica.get_playback_position()))
	fk_output_arr[array_num].append($Musica.get_playback_position() - fk_fall_time)
		
		
func SpawnFallingKey(button_name: String, delay: float):
	await  get_tree().create_timer(delay).timeout
	Senales.CreateFallingKey.emit(button_name)

func _on_musica_finished():
	print(fk_output_arr)
